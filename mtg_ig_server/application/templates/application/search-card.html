{% load static %}
{% load my_filters %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>MTG Memes</title>
        <link rel="shortcut icon" type="image/ico" href="{% static 'images/favicon.ico' %}"/>

        <script src="{% static 'js/main.js' %}" defer></script>

        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <link rel="stylesheet" href="{% static 'css/search.css' %}">
        <link rel="stylesheet" href="{% static 'css/animations.css' %}">

        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700&display=swap" rel="stylesheet"> 
        <link href="https://fonts.googleapis.com/css?family=Roboto:500&display=swap" rel="stylesheet"> 

        <!-- import Chart.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css">

    </head>
    <body>
        <div class="wrapper">

            <div id="background" class="background">
            </div>

            <div class="content">

                <nav>
                    <ul class="navbar navbar-search">
                        <li class="navtext navtext-left"><a href="{% url 'index' %}">MTG Investor's Grail</a></li>
                        <form action="/search-card/" method="GET">
                            {{ form }}
                        </form>
                        {% if user.is_authenticated %}
                        <li class="navtext"><a href="{% url 'logout' %}">Log out</a></li>
                        <li class="navtext"><a href="{% url 'profile' %}">Profile</a></li>
                        {% else %}
                        <li class="navtext"><a href="{% url 'register' %}">Register</a></li>
                        <li class="navtext" id="navLi"><a href="{% url 'login' %}">Login</a></li>
                        {% endif %}
                        <li class="navtext"><a href="{% url 'contact' %}">Contact</a></li>
                        <li class="navtext"><a href="{% url 'about' %}">About</a></li>
                        <li class="navtext"><a href="{% url 'howItWorks' %}">How it Works</a></li>
                    </ul>
                </nav>

                {% if card.image_uris %}
                <div class="mainContent">
                    <div class="aboutImage">
                        <img src="{{ card.image_uris.border_crop }}">
                    </div>
                    <div class="aboutTextBox">
                        <p class="cardtext cardtext-name">{{ card.name }} — {{ card.mana_cost }}</p>

                        {% if user.is_authenticated %}
                        <form method="POST">
                            {{ form1 }}
                            {% csrf_token %}
                            <button class="saveButton" action="" name="save">Save Card</button>
                        </form>
                        {% endif %}

                        {% if user.is_authenticated %}
                        <form method="POST">
                            {{ form2 }}
                            {% csrf_token %}
                            <button class="saveButton" action="" name="save">Delete Saved Card</button>
                        </form>
                        {% endif %}


                        <p class="cardtext cardtext-typeline"> {{ card.type_line }}</p>
                        <p class="cardtext cardtext-oracletext">{{ card.oracle_text|linebreaksbr }}</p>
                        <div>
                            <canvas id="priceChart" height="300" width="600"></canvas>
                            <script>
                                var ctx = document.getElementById('priceChart').getContext('2d');
                                var chart = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: ["Current", "In 1 month", "In 2 months"],
                                        datasets: [
                                        {
                                            {% if card.prices.usd %} 
                                            data: [
                                            {{ card.prices.usd }}, 10, 12],
                                            label: "Price (USD)",
                                            borderColor: "#3e95cd",
                                            fill: false
                                            {% endif %}
                                        }, {
                                            {% if card.prices.usd_foil %}
                                            data: [
                                            {{ card.prices.usd_foil }}, 20, 30],
                                            label: "Foil Price (USD)",
                                            borderColor: "#8e5ea2",
                                            fill: false
                                            {% endif %}
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            yAxes: [{
                                                ticks: {
                                                    beginAtZero: true
                                                }
                                            }]
                                        },
                                        legend: {
                                            fontColor: "white"
                                        },
                                        title: {
                                            display: false
                                        },
                                        responsive: false,
                                        maintainAspectRatio: false
                                    }
                                });
                            </script>
                        </div>
                    </div>
                    <div class="captionBox">
                        {% with "https://shop.tcgplayer.com/product/productsearch?id="|addstr:card.tcgplayer_id|addstr:"&partner=MTGInvestorsGrail&utm_campaign=affiliate&utm_medium=MTGInvestorsGrail&utm_source=MTGInvestorsGrail" as yeet %}
                        {# use variable yeet #}
                        <a class="captionText" href="{{ yeet }}" target="_blank">
                            <svg aria-hidden="true" focusable="false" width="15" height="15" viewBox="0 0 15 15">
                                <path class="icon" d="M6.275 1H3.083c-.562 0-1 .447-1 1v11c0 .553.448 1 1 1h8.834c.562 0 1-.447 1-1V2c0-.553-.448-1-1-1h-1.862l.684 
                                3.15c.032.096-.01.175-.126.235-.084.044-.184.066-.3.066-.052 0-.09 
                                0-.116-.005L7.358 5.64l.82 4.054c.025.064.01.124-.045.18-.054.056-.137.094-.246.114-.065.008-.11.012-.135.012-.187 
                                0-.323-.05-.407-.15L4.29 4.897c-.07-.097-.048-.185.068-.265.097-.06.206-.09.33-.09.025 
                                0 .063.004.115.012l2.746-1.41L6.274 1zM1 1.007C1 .45 1.447 0 2 0h11c.553 0 1 .45 1 1.007v12.986C14 
                                14.55 13.553 15 13 15H2c-.553 0-1-.45-1-1.007V1.007z" fill="#000" fill-rule="evenodd">
                                </path>
                            </svg>
                            Buy on TCGPlayer
                            <span class="priceText">{{ card.prices.usd }}</span>
                        </a>
                        <br>
                        <a class="captionText" href="{{ yeet }}" target="_blank">
                            <svg aria-hidden="true" focusable="false" width="15" height="15" viewBox="0 0 15 15">
                                <path class="icon" d="M6.275 1H3.083c-.562 0-1 .447-1 1v11c0 .553.448 1 1 1h8.834c.562 0 1-.447 1-1V2c0-.553-.448-1-1-1h-1.862l.684 
                                3.15c.032.096-.01.175-.126.235-.084.044-.184.066-.3.066-.052 0-.09 
                                0-.116-.005L7.358 5.64l.82 4.054c.025.064.01.124-.045.18-.054.056-.137.094-.246.114-.065.008-.11.012-.135.012-.187 
                                0-.323-.05-.407-.15L4.29 4.897c-.07-.097-.048-.185.068-.265.097-.06.206-.09.33-.09.025 
                                0 .063.004.115.012l2.746-1.41L6.274 1zM1 1.007C1 .45 1.447 0 2 0h11c.553 0 1 .45 1 1.007v12.986C14 
                                14.55 13.553 15 13 15H2c-.553 0-1-.45-1-1.007V1.007z" fill="#000" fill-rule="evenodd">
                                </path>
                            </svg>
                            Buy foil on TCGPlayer
                            <span class="priceText">{{ card.prices.usd_foil }}</span>
                        </a>
                        {% endwith %}
                    </div>
                </div>

                {% elif card.card_faces %}

                <div class="flexContainer">
                    <div class="mainContent mainContent-fliptop">
                        <div class="aboutImage">
                            <img src="{{ card.card_faces.0.image_uris.border_crop }}">
                        </div>
                        <div class="aboutTextBox">
                            <p class="cardtext cardtext-name">{{ card.card_faces.0.name }} — {{ card.card_faces.0.mana_cost }}</p>
                            <p class="cardtext cardtext-typeline"> {{ card.card_faces.0.type_line }}</p>
                            <p class="cardtext cardtext-oracletext">{{ card.card_faces.0.oracle_text|linebreaksbr }}</p>
                            <div>
                                <canvas id="priceChart" height="300" width="600"></canvas>
                                <script>
                                    var ctx = document.getElementById('priceChart').getContext('2d');
                                    var chart = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                            labels: ["Current", "In 1 month", "In 2 months"],
                                            datasets: [
                                            {% if card.prices.usd %}
                                            {
                                                data: [
                                                {{ card.prices.usd }}, 10, 12],
                                                label: "Price (USD)",
                                                borderColor: "#3e95cd",
                                                fill: false
                                            }, 
                                            {% endif %}
                                            {% if card.prices.usd_foil %}
                                            {
                                                data: [
                                                {{ card.prices.usd_foil }}, 20, 30],
                                                label: "Foil Price (USD)",
                                                borderColor: "#8e5ea2",
                                                fill: false
                                            }
                                            {% endif %}]
                                        },
                                        options: {
                                            scales: {
                                                yAxes: [{
                                                    ticks: {
                                                        beginAtZero: true
                                                    }
                                                }]
                                            },
                                            legend: {
                                                fontColor: "white"
                                            },
                                            title: {
                                                display: false
                                            },
                                            responsive: false,
                                            maintainAspectRatio: false
                                        }
                                    });
                                </script>
                            </div>
                        </div>
                        <div class="captionBox">
                            {% with "https://shop.tcgplayer.com/product/productsearch?id="|addstr:card.tcgplayer_id|addstr:"&partner=MTGInvestorsGrail&utm_campaign=affiliate&utm_medium=MTGInvestorsGrail&utm_source=MTGInvestorsGrail" as yeet %}
                            {# use variable yeet #}
                            <a class="captionText" href="{{ yeet }}" target="_blank">
                                <svg aria-hidden="true" focusable="false" width="15" height="15" viewBox="0 0 15 15">
                                    <path class="icon" d="M6.275 1H3.083c-.562 0-1 .447-1 1v11c0 .553.448 1 1 1h8.834c.562 0 1-.447 1-1V2c0-.553-.448-1-1-1h-1.862l.684 
                                    3.15c.032.096-.01.175-.126.235-.084.044-.184.066-.3.066-.052 0-.09 
                                    0-.116-.005L7.358 5.64l.82 4.054c.025.064.01.124-.045.18-.054.056-.137.094-.246.114-.065.008-.11.012-.135.012-.187 
                                    0-.323-.05-.407-.15L4.29 4.897c-.07-.097-.048-.185.068-.265.097-.06.206-.09.33-.09.025 
                                    0 .063.004.115.012l2.746-1.41L6.274 1zM1 1.007C1 .45 1.447 0 2 0h11c.553 0 1 .45 1 1.007v12.986C14 
                                    14.55 13.553 15 13 15H2c-.553 0-1-.45-1-1.007V1.007z" fill="#000" fill-rule="evenodd">
                                    </path>
                                </svg>
                                Buy on TCGPlayer
                                <span class="priceText">{{ card.prices.usd }}</span>
                            </a>
                            <br>
                            <a class="captionText" href="{{ yeet }}" target="_blank">
                                <svg aria-hidden="true" focusable="false" width="15" height="15" viewBox="0 0 15 15">
                                    <path class="icon" d="M6.275 1H3.083c-.562 0-1 .447-1 1v11c0 .553.448 1 1 1h8.834c.562 0 1-.447 1-1V2c0-.553-.448-1-1-1h-1.862l.684 
                                    3.15c.032.096-.01.175-.126.235-.084.044-.184.066-.3.066-.052 0-.09 
                                    0-.116-.005L7.358 5.64l.82 4.054c.025.064.01.124-.045.18-.054.056-.137.094-.246.114-.065.008-.11.012-.135.012-.187 
                                    0-.323-.05-.407-.15L4.29 4.897c-.07-.097-.048-.185.068-.265.097-.06.206-.09.33-.09.025 
                                    0 .063.004.115.012l2.746-1.41L6.274 1zM1 1.007C1 .45 1.447 0 2 0h11c.553 0 1 .45 1 1.007v12.986C14 
                                    14.55 13.553 15 13 15H2c-.553 0-1-.45-1-1.007V1.007z" fill="#000" fill-rule="evenodd">
                                    </path>
                                </svg>
                                Buy foil on TCGPlayer
                                <span class="priceText">{{ card.prices.usd_foil }}</span>
                            </a>
                            {% endwith %}
                        </div>
                    </div>

                    <div class="mainContent mainContent-flipbottom">
                        <div class="aboutImage">
                            <img src="{{ card.card_faces.1.image_uris.border_crop }}">
                        </div>
                        <div class="aboutTextBox">
                            <p class="cardtext cardtext-name">{{ card.card_faces.1.name }} — {{ card.card_faces.1.mana_cost }}</p>
                            <p class="cardtext cardtext-typeline"> {{ card.card_faces.1.type_line }}</p>
                            <p class="cardtext cardtext-oracletext">{{ card.card_faces.1.oracle_text|linebreaksbr }}</p>
                            <div>

                            </div>
                        </div>
                        <div class="captionBox">
                            {% with "https://shop.tcgplayer.com/product/productsearch?id="|addstr:card.tcgplayer_id|addstr:"&partner=MTGInvestorsGrail&utm_campaign=affiliate&utm_medium=MTGInvestorsGrail&utm_source=MTGInvestorsGrail" as yeet %}
                            {# use variable yeet #}
                            <a class="captionText" href="{{ yeet }}" target="_blank">
                                <svg aria-hidden="true" focusable="false" width="15" height="15" viewBox="0 0 15 15">
                                    <path class="icon" d="M6.275 1H3.083c-.562 0-1 .447-1 1v11c0 .553.448 1 1 1h8.834c.562 0 1-.447 1-1V2c0-.553-.448-1-1-1h-1.862l.684 
                                    3.15c.032.096-.01.175-.126.235-.084.044-.184.066-.3.066-.052 0-.09 
                                    0-.116-.005L7.358 5.64l.82 4.054c.025.064.01.124-.045.18-.054.056-.137.094-.246.114-.065.008-.11.012-.135.012-.187 
                                    0-.323-.05-.407-.15L4.29 4.897c-.07-.097-.048-.185.068-.265.097-.06.206-.09.33-.09.025 
                                    0 .063.004.115.012l2.746-1.41L6.274 1zM1 1.007C1 .45 1.447 0 2 0h11c.553 0 1 .45 1 1.007v12.986C14 
                                    14.55 13.553 15 13 15H2c-.553 0-1-.45-1-1.007V1.007z" fill="#000" fill-rule="evenodd">
                                    </path>
                                </svg>
                                Buy on TCGPlayer
                                <span class="priceText">{{ card.prices.usd }}</span>
                            </a>
                            <br>
                            <a class="captionText" href="{{ yeet }}" target="_blank">
                                <svg aria-hidden="true" focusable="false" width="15" height="15" viewBox="0 0 15 15">
                                    <path class="icon" d="M6.275 1H3.083c-.562 0-1 .447-1 1v11c0 .553.448 1 1 1h8.834c.562 0 1-.447 1-1V2c0-.553-.448-1-1-1h-1.862l.684 
                                    3.15c.032.096-.01.175-.126.235-.084.044-.184.066-.3.066-.052 0-.09 
                                    0-.116-.005L7.358 5.64l.82 4.054c.025.064.01.124-.045.18-.054.056-.137.094-.246.114-.065.008-.11.012-.135.012-.187 
                                    0-.323-.05-.407-.15L4.29 4.897c-.07-.097-.048-.185.068-.265.097-.06.206-.09.33-.09.025 
                                    0 .063.004.115.012l2.746-1.41L6.274 1zM1 1.007C1 .45 1.447 0 2 0h11c.553 0 1 .45 1 1.007v12.986C14 
                                    14.55 13.553 15 13 15H2c-.553 0-1-.45-1-1.007V1.007z" fill="#000" fill-rule="evenodd">
                                    </path>
                                </svg>
                                Buy foil on TCGPlayer
                                <span class="priceText">{{ card.prices.usd_foil }}</span>
                            </a>
                            {% endwith %}
                        </div>
                    </div>
                </div>
                {% endif %}
                    <footer class="footer">
                        <p class="footertext">Parts of MTG Investor's Grail are unofficial fan content permitted under the Wizards of the Coast Fan Content Policy. 
                            <br>The literal and graphical content shown on this website about Magic: The Gathering, including card images, oracle text, etc. is
                            copyright Wizards of the Coast, LLC, a subsidiary of Hasbro, Inc. 
                            <br>MTG Investor's Grail is not sponsored by, endorsed by, or affiliated with 
                            Wizards of the Coast.
                        </p>
                        <p class="footertext">Website created by Alexander Wei</p class="footertext">
                        <p class="footertext">Other content Copyright © 2019 MTG Investor's Grail</p class="footertext">
                    </footer>
                </div>
            </div>
        </div>
    </body>
</html>